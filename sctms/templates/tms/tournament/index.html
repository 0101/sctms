{% extends 'tms/base.html' %}

{% load i18n cache markup %}

{% block title %}{{ tournament.name }}{% endblock %}

{% block content %}
<hgroup class="h1">
    <span class="breadcrumbs"><a href="/">{% trans "Home" %}</a> > </span><h1>{{ tournament.name }}</h1>
</hgroup>

{% if tournament.slogan %}<div class="tournament-slogan">&ldquo;{{ tournament.slogan }}&rdquo;</div>{% endif %}

<div class="content-wrap tournament">
    <div class="box {{ current_view }}">
        <nav class="clearfix">
            <a {% if current_view == 'tournament' %}class="selected"{% endif %}
               href="{{ tournament.get_absolute_url }}">{% trans "Info" %}</a>
            <a {% if current_view == 'tournament_players' %}class="selected"{% endif %}
               href="{% url tms:tournament_players slug=tournament.slug %}">{% trans "Players" %}</a>
            <a {% if current_view == 'tournament_round' or current_view == 'tournament_rounds' %}class="selected"{% endif %}
               href="{% url tms:tournament_rounds slug=tournament.slug %}">{% trans "Rounds" %}</a>
            {% if tournament.current_round %}
                <a {% if current_view == 'result_report' %}class="selected"{% endif %}
                   href="{% url tms:result_report slug=tournament.slug %}">{% trans "Report match results" %}</a>
            {% endif %}
            {% with user.get_profile as player %}
            {% if tournament.registration_open and not user.get_profile in tournament %}
                <a {% if current_view == 'join_tournament' %}class="selected"{% endif %}
                    href="{% url tms:join_tournament slug=tournament.slug %}">{% trans "Join tournament" %}</a>
            {% endif %}
                {% if tournament.registration_open and user.get_profile in tournament %}
                <a {% if current_view == 'leave_tournament' %}class="selected"{% endif %}
                    href="{% url tms:leave_tournament slug=tournament.slug %}">{% trans "Leave tournament" %}</a>
            {% endif %}
            {% endwith %}
        </nav>
        <div class="box-content">
            {% block box-content %}
            {% cache 90000000 info tournament.id %}

                <h2 id="info">{% trans "About" %}<span class="icon"></span></h2>
                {% block about %}
                    <ul>
                        <li>{% trans "Event type" %}: <strong title="{{ tournament.description }}">{{ tournament.format.name }}</strong></li>
                        <li>{% trans "Format" %}: <strong>1v1</strong></li>
                    </ul>

                    <h3>{% trans "Registration deadline" %}</h3>
                    <ul>
                    <li><strong>{{ tournament.registration_deadline|date:"d. m. Y G:i" }}</strong> CEST {% if tournament.registration_open %}
                    &ndash; {% trans "in" %} {{ tournament.registration_deadline|timeuntil }}</li>
                    <li>Click <strong><a href="{% url tms:join_tournament slug=tournament.slug %}">{% trans "Join tournament" %}</a></strong> to register{% endif %}</li>
                    <li>{% trans "Players registered" %}: <strong><a href="{% url tms:tournament_players slug=tournament.slug %}">{{ tournament.players.count }}</a></strong></li>
                    </ul>

                    <h3>{% trans "Start" %}</h3>
                    <p>{% trans "The next day after registration deadline." %}

                    <h3>{% trans "Map pack" %}</h3>
                    <p>{{ tournament.map_pool.all|join:", " }}</p>

                    <h3>{% trans "Round dates, maps and pairing" %}</h3>
                    {% url tms:tournament_rounds slug=tournament.slug as rounds_url %}
                    <p>{% blocktrans with rounds_url as url %}Will be published under <a href="{{ url }}">Rounds</a> after registration deadline.{% endblocktrans %}
                {% endblock %}

                {% if tournament.additional_information %}
                    {{ tournament.additional_information|markdown }}
                {% endif %}

                {% comment %}
                <h3>Defaultní termíny a mapy pro jednotlivá kola</h3>
                <ul>
                    <li><b>Základní část</b>
                    <ul>
                        {% for round in tournament.rounds_swiss %}
                            <li><strong>{{ round.description }}</strong> &gt;&gt; {{ round.start|date:"d. m." }} - {{ round.end|date:"d. m." }}, {{ round.first_map }}</li>
                        {% endfor %}
                    </ul></li>
                    <li><br/></li>
                    <li><b>Playoff</b>
                    <ul>
                        {% for round in tournament.rounds_playoff %}
                            <li><strong>{{ round.description }}</strong> &gt;&gt; {{ round.start|date:"d. m." }} - {{ round.end|date:"d. m." }}, {{ round.first_map }}</li>
                        {% endfor %}
                    </ul></li>
                </ul>

                <br/>
                <h3>Informace o lize</h3>
                <ul>
                    <li><b>formát ligy:</b> 1v1</li>
                    <li><b>registrace:</b> {{ tournament.registration_deadline }} CEST</li>
                    <li><b>začátek:</b> {{ tournament.rounds.0.start|date:"d. m." }} 0:00 CEST </li>
                    <li><b>počet účastníků:</b> {{ tournament.players.count }}</li>
                    <li><b>formát ligy:</b> základní část BO3 švýcarským systémem <b>{{ tournament.rounds_swiss.count }} kol</b>, následovat bude BO5 (finále BO7) single elimination <b>playoff pro top 8</b> základní části</li>
                    <li><b>časový průběh ligy:</b> 5 dní na kolo v základní části (vychází to na každé kolo alespoň jeden den sobota/neděle), playoff se odehraje formou týdenního nataženého turnaje/eventu coby vyvrcholení sezóny, finále se pak (snad) odehraje poslední den.</li>
                    <li><b>ceny:</b> dobrý pocit a účast v hall of fame pro vítěze resp. top4, zahrání si pro každého a případné nasazení do budoucích turnajů</li>
                    <li><b>mappack:</b> {{ tournament.map_pool.all|join:", " }}</li>
                </ul>
                {% endcomment %}

                {% if tournament.prices %}
                    <h2 id="prices">{% trans "Prices" %}<span class="icon"></span></h2>
                    {{ tournament.prices|markdown }}
                {% endif %}

                <h2 id="rules">{% trans "Rules" %}<span class="icon"></span></h2>
                {{ tournament.rules|markdown }}

            {% endcache %}
            {% endblock %}
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
{{ block.super }}
<script type="text/javascript">
// preload loading animation
$('<img/>').attr('src', '{{ MEDIA_URL }}img/loading_bar.gif');
$('.tournament .box nav a').click(function(){ $(this).addClass('loading'); });
</script>
{% endblock %}
